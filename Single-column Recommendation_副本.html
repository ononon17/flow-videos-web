<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>Single-column Recommendation</title>
<style>
/* --- åŸºç¡€æ ·å¼ --- */
*{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent;}
body{background-color:#000;color:#fff;font-family:-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; overflow: hidden; height: 100vh; width: 100vw;}

/* --- å®éªŒå‡†å¤‡é¡µ --- */
#prep-page { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background-color: #000; color: #fff; z-index: 50000; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; }
#prep-page h1 { font-size: 32px; margin-bottom: 20px; letter-spacing: 2px; }
#prep-page p { font-size: 18px; color: #888; margin-bottom: 60px; }
#start-btn { background-color: #f6404f; color: white; padding: 18px 60px; border-radius: 12px; font-size: 20px; font-weight: bold; border: none; cursor: pointer; }

/* --- é¡¶éƒ¨å¯¼èˆªæ  (æ¨èæ¿€æ´») --- */
.top-nav { position: fixed; top: 0; left: 0; width: 100vw; height: 80px; display: flex; justify-content: center; align-items: center; gap: 25px; z-index: 1000; pointer-events: none; background: linear-gradient(to bottom, rgba(0,0,0,0.5), transparent); }
.nav-item { color: rgba(255, 255, 255, 0.6); font-size: 17px; font-weight: 600; pointer-events: auto; position: relative; text-shadow: 0 1px 2px rgba(0,0,0,0.5); }
.nav-item.active { color: #fff; }
.nav-item.active::after { content: ''; position: absolute; bottom: -8px; left: 50%; transform: translateX(-50%); width: 22px; height: 2.5px; background: #fff; border-radius: 2px; }

/* --- è§†é¢‘å®¹å™¨ --- */
#video-feed { height: 100vh; width: 100vw; overflow-y: scroll; scroll-snap-type: y mandatory; display: none; background: #000; }
#video-feed::-webkit-scrollbar { display: none; }
.video-item { position: relative; width: 100vw; height: 100vh; scroll-snap-align: start; background: #000; display: flex; justify-content: center; align-items: center; overflow: hidden; }
video { width: 100%; height: 100%; object-fit: cover; display: block; opacity: 0; transition: opacity 0.4s; }
video.ready { opacity: 1; }

/* --- äº¤äº’å›¾æ ‡ --- */
.pause-icon { position: absolute; font-size: 80px; color: rgba(255,255,255,0.4); pointer-events: none; display: none; z-index: 50; }
.video-item.is-paused .pause-icon { display: block; }

/* --- ğŸ”´ æ–‡æ¡ˆå¸ƒå±€é”æ­» (ä¿®å¤åæ–œ) --- */
.overlay { 
    position: absolute; bottom: 0; left: 0; width: 100%; 
    padding: 0 95px 48px 16px; /* å¼ºåˆ¶é¿å¼€å³ä¾§ä¾§è¾¹æ  */
    pointer-events: none; z-index: 10;
    background: linear-gradient(to top, rgba(0,0,0,0.8) 0%, transparent 40%); 
    text-align: left;
}
.user-name { font-weight: 700; font-size: 16px; color: #fff; margin-bottom: 8px; display: block; text-shadow: 0 1px 2px rgba(0,0,0,0.5); }
.video-desc { font-size: 14px; line-height: 1.5; color: rgba(255,255,255,0.95); display: block; }

/* --- ğŸ”´ ä¾§è¾¹æ å‚ç›´å±…ä¸­ --- */
.sidebar { position: absolute; right: 10px; bottom: 110px; display: flex; flex-direction: column; gap: 22px; align-items: center; z-index: 100; width: 55px; }
.icon-group { display: flex; flex-direction: column; align-items: center; width: 100%; text-align: center; }
.icon-btn { width: 48px; height: 48px; background: rgba(255,255,255,0.2); border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 28px; backdrop-filter: blur(8px); color: #ffffff; cursor: pointer; margin-bottom: 3px; transition: transform 0.1s; }
.icon-btn.liked { color: #ff2442; }
.count-text { font-size: 12px; color: #fff; text-shadow: 0 1px 2px rgba(0,0,0,0.5); }

/* --- å¤§å¿ƒåŠ¨ç”» --- */
.floating-heart { position: fixed; pointer-events: none; color: #ff2442; font-size: 100px; z-index: 9999; transform: translate(-50%, -50%) scale(0); opacity: 0; animation: heartFloat 0.8s ease-out; }
@keyframes heartFloat { 0% { transform: translate(-50%, -50%) scale(0) rotate(-15deg); opacity: 0; } 20% { transform: translate(-50%, -50%) scale(1.2) rotate(-15deg); opacity: 1; } 100% { transform: translate(-50%, -160%) scale(1.5) rotate(-15deg); opacity: 0; } }

/* --- ç»“æœå¼¹çª— --- */
#result-modal { display: none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.95); z-index: 60000; justify-content: center; align-items: center; }
.modal-content { background: #fff; color: #333; padding: 30px 25px; border-radius: 20px; width: 85%; max-width: 320px; text-align: center; }
.code-box { background: #f8f9fa; padding: 15px; margin: 15px 0; font-family: monospace; font-size: 11px; color: #d32f2f; border: 1px dashed #ced4da; border-radius: 10px; word-break: break-all; }
.copy-btn { background: #007bff; color: white; border: none; padding: 14px 0; border-radius: 10px; font-size: 16px; font-weight: bold; width: 100%; cursor: pointer; }
</style>
</head>
<body>

<div id="prep-page">
    <h1>å®éªŒå‡†å¤‡å°±ç»ª</h1>
    <p>è¯·å¼€å¯æ‰‹æœºéŸ³é‡</p>
    <button id="start-btn" onclick="startBrowsing()">ç‚¹å‡»å¼€å§‹æµè§ˆ</button>
</div>

<div id="top-nav-bar" class="top-nav" style="display:none;">
    <span class="nav-item">å…³æ³¨</span>
    <span class="nav-item active">æ¨è</span>
</div>

<div id="video-feed"></div>

<div id="result-modal">
    <div class="modal-content">
        <div style="font-weight:bold; font-size:18px;">å®éªŒç»“æŸ</div>
        <p style="font-size:13px; color:#666; margin-top:10px;">å®éªŒæ•°æ®å·²ä¿å­˜ï¼Œè¯·å¤åˆ¶éªŒè¯ç ï¼š</p>
        <div class="code-box" id="code-display"></div>
        <button class="copy-btn" onclick="copyCode()">å¤åˆ¶éªŒè¯ç å¹¶å¡«å…¥é—®å·</button>
    </div>
</div>

<script>
// --- 1. æ•°æ®é…ç½® ---
const adRaw = [
    { id: "W1", url: "https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/6f41955d07179e17aa0e3b87394cf88c.MP4", desc: "Longinesæµªç´è¡¨ï¼šä¼˜é›…æ€åº¦ï¼ŒçœŸæˆ‘ä¸ªæ€§âŒšï¸" },
    { id: "W2", url: "https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/1a2ab6a2567fa104084b1f1ef0f366fe.MP4", desc: "CASIOå¡è¥¿æ¬§ï¼šåšéŸ§ä¸æ­¢ï¼Œæ½®æµå…ˆé”‹ğŸ¤˜" },
    { id: "P1", url: "https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/1c119470ab39cf18c4c7da419f8b4276.mov", desc: "OPPO Find Xï¼šç§‘æŠ€ä¹‹å–„ï¼Œä¸€ç¬å€¾å¿ƒğŸ“±" },
    { id: "P2", url: "https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/d185adecd1feadf6fcb59df491fa1ee6.MP4", desc: "HONORè£è€€ï¼šç¬ƒè¡Œè‡´è¿œï¼Œè£è€€åŒè¡ŒğŸš€" },
    { id: "S1", url: "https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/8335b86b739187f29afcb3a8ed798b60.mov", desc: "å¤§å®ï¼šå¤©å¤©è§ï¼ŒçœŸæƒ…å®ˆæŠ¤ SODèœœâœ¨" },
    { id: "S2", url: "https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/89a65e149982ff319e90d49de2de4058.MP4", desc: "è‡ªç„¶å ‚ï¼šé›ªåŸŸå†°è‚Œï¼Œä½ æœ¬æ¥å°±å¾ˆç¾ğŸ”ï¸" }
];

const nativeCats = [
    { links: ["https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/9cb3038b5cd9cf8a5e0d3dbd3777079f.MP4","https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/d1ce20c07df8e58e2c0234d038d5ff9c.MP4","https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/6ea9d5dc591d7b94bca7bc52225df31f.MP4","https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/ba5692b9bb0f19ef899c43aaec24b874.MP4","https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/9490d9ae3898c3c6fe64478787e12305.MP4","https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/809f8bca29d20f298627b62e0a66e1a1.MP4","https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/072a130e6fe54342aef13ce8bc81bc84.mov","https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/d274bd241a4ac6177358ec440509b9f9.MP4","https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/10292bbf1c9c525b1a8a5fac54125a48.mov"], titles: ["è°æ‡‚å•Šï¼å¤ªæ²»æ„ˆäº†ğŸœ", "æ·±å¤œé£Ÿå ‚é­…åŠ›å—ğŸ°", "æ±‰å ¡å¤ªç¾å‘³âœ¨", "ç«è…¿è‚ ç„–é¸¡è›‹ğŸ¤¤", "å®¶äººä»¬çœŸçš„ç¬‘å‘è´¢ğŸ³", "è¿™æ‰æ˜¯å¤©èŠ±æ¿ğŸ•", "å¤åˆ»é¡¶çº§ç«é¸¡é¢ğŸ¥©", "æµäº†ä¸€åœ°å£æ°´ğŸ’¦", "å¿«ä¹æ˜¯æ‹¿é“ç»™çš„ğŸ¥˜"] },
    { links: ["https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/224d2320db82f468e0f61bac29b0631d.MP4","https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/0e9ce81ab7ae5612973e168ae530e7bd.MP4","https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/c291690cf2ad86c1fb5bd8c6492476c4.MP4","https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/c429a062f64d9b817c0e0332f5dbe3f9.MP4","https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/db3c30002d626d081680a6a99c2cad8e.MP4","https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/c111d107b33699d5d4bf2528eb7c757c.MP4","https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/d7bca7e3fb4c3a984773b2b6f45a7d04.MP4","https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/03b18c6151c04b68ae573894bb2c1370.MP4","https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/fe37a2d2bfe0e2c6e357705a62a5de53.MP4"], titles: ["å…¨åœºç‡ƒåˆ°äº†ğŸ”¥", "ç¬‘åˆ°æ‰“é¸£ğŸ¤£ğŸ¤£", "ç¥çº§è½¬åœºğŸ¬", "å…¨åœºçœ‹å“­ğŸ˜­", "æ¢—ç©ä¸€å¹´ğŸ¤¡", "åä¾¦æ¢æ—¶åˆ»ğŸ•µï¸", "è¿™å°±æ˜¯å®åŠ›ğŸ™", "å°´å°¬æ¯›ç—…çŠ¯äº†ğŸ™ˆ", "ç»“å±€åè½¬ğŸŒ€"] },
    { links: ["https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/d92e7a8c43b8f52618e52b227cb49d4a.MP4","https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/3b03c532c9ab2488380b510b20795dce.MP4","https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/899d1c39ab8c6355619af4d1b63b57f4.MP4","https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/ad54701eecc91d9d63655b90bd6a9a28.MP4","https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/a725c0c79871ef092a27ca786b199813.MP4","https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/1b7d44ae2f3bf47cea1a0521feffc97c.MP4","https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/54ac52d07178f6e577b88f5a691cdae6.MP4","https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/18b6f4865bade59168068d120b9fa70b.MP4","https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/9697e3b13e163eb2ac045428d1bd5fa7.MP4"], titles: ["ç²¾ç¥çŠ¶æ€", "ç¬‘å‘è´¢äº†ğŸ’°", "å…¨åœºæ²‰é»˜ğŸ¤¡", "ä»Šæ—¥å¹½é»˜ğŸ“®", "å¤§å†¤ç§ğŸ‘­", "ç¬‘å–·äº†ğŸ’¥", "å¤ªæœ‰æ‰äº†ğŸ’¬", "ç¤¾æå™©æ¢¦ğŸ‘»", "è°è®¾è®¡çš„ï¼ŸğŸ‘Š"] },
    { links: ["https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/2c13f0ec2632db517d5121ede6b64993.mov","https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/222ddf22f8ecdd36fdd6b338a36d97f5.MP4","https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/4cc6bbd6c027d96cef6ca79c7dab2b9d.mov","https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/ca7fa1fb72c5847d8766ce10f3372788.MP4","https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/c70155ef59964ab38f15589833a670ba.MP4","https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/014ff2312c0eeaa4c7f801e3544d4302.mov","https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/50ea2aad16b82e75f3310ce019c4e358.MP4","https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/c12c417443e17e37f597e63c16e0ae80.MP4"], titles: ["äº‘å—ğŸ“¸", "å¤§ç†æ—¥è½ğŸŒŠ", "å»å‘å‘†å§â˜ï¸", "ç©ºæ°”è‡ªç”±ğŸƒ", "å¿…å»åœ°æ–¹ğŸ“", "å‘å¾€ç”Ÿæ´»ğŸï¸", "é¿å‘æŒ‡å—ğŸ“‘", "å¤©å ‚é”™è§‰ğŸŒ´"] }
];

// --- 2. é€»è¾‘é€»è¾‘ ---
let adStats = { "W1":0, "W2":0, "P1":0, "P2":0, "S1":0, "S2":0 };
let playlist = [], clickTimer = null;

function shuffle(a) { for (let i = a.length-1; i > 0; i--) { const j = Math.floor(Math.random()*(i+1)); [a[i], a[j]] = [a[j], a[i]]; } return a; }

function initData() {
    let allN = [];
    nativeCats.forEach(c => c.links.forEach((l, i) => allN.push({ url: l, desc: c.titles[i], likes: (Math.random()*8+1).toFixed(1)+"w", type: "content" })));
    shuffle(allN);
    let sAds = shuffle([...adRaw]).map(ad => ({ ...ad, likes: (Math.random()*2+1).toFixed(1)+"w", type: "ad" }));
    for (let i = 1, ni = 0, ai = 0; i <= 41; i++) {
        if ([6,12,18,24,30,36].includes(i)) playlist.push(sAds[ai++]); else playlist.push(allN[ni++]);
    }
}

// ğŸ”´ å±‚çº§å¼å¹¶è¡Œé¢„åŠ è½½ (æ ¸å¿ƒä¿®å¤)
async function checkAndPrime(v) {
    if (!v.getAttribute('data-src')) return;
    if (!v.src) v.src = v.getAttribute('data-src'); 
    try {
        if (v.readyState < 2) {
            v.muted = true; await v.play(); v.pause(); v.currentTime = 0.5; // è·³è½¬0.5sé¿å¼€é»‘å¸§
        }
        v.classList.add('ready');
    } catch(e) {}
}

function startBrowsing() {
    document.getElementById('prep-page').style.display = 'none';
    document.getElementById('video-feed').style.display = 'block';
    document.getElementById('top-nav-bar').style.display = 'flex';
    // åˆå§‹å”¤é†’å‰ 4 ä¸ª
    const vids = document.querySelectorAll('.video-item video');
    for(let i=0; i<4; i++) if(vids[i]) checkAndPrime(vids[i]);
    setTimeout(() => openModal(true), 120000); 
}

function renderUI() {
    const feed = document.getElementById('video-feed');
    playlist.forEach((item, i) => {
        const div = document.createElement('div');
        div.className = 'video-item';
        if(item.id) { div.setAttribute('data-ad', item.id); div.setAttribute('data-start', '0'); }
        
        div.innerHTML = `
            <video data-src="${item.url}" loop playsinline muted webkit-playsinline></video>
            <div class="pause-icon">â–¶</div>
            <div class="overlay">
                <span class="user-name">@ç”¨æˆ·_${1000+i}</span>
                <span class="video-desc">${item.desc}</span>
            </div>
            <div class="sidebar">
                <div class="icon-group"><div class="icon-btn heart" onclick="hLike(this, null)">â¤</div><div class="count-text">${item.likes}</div></div>
                <div class="icon-group"><div class="icon-btn">ğŸ’¬</div><div class="count-text">${Math.floor(Math.random()*900)+100}</div></div>
                <div class="icon-group"><div class="icon-btn">ğŸ”—</div><div class="count-text">åˆ†äº«</div></div>
            </div>`;
        
        const v = div.querySelector('video');
        div.addEventListener('click', (e) => {
            if(e.target.closest('.sidebar')) return;
            if (clickTimer) { clearTimeout(clickTimer); clickTimer = null; hLike(div.querySelector('.heart'), e); } 
            else { clickTimer = setTimeout(() => { if(v.paused){ v.play(); div.classList.remove('is-paused'); } else { v.pause(); div.classList.add('is-paused'); } clickTimer = null; }, 250); }
        });
        feed.appendChild(div);
    });
}

function recordTime(el, isEntering) {
    const adId = el.getAttribute('data-ad'); if (!adId) return;
    if (isEntering) { el.setAttribute('data-start', Date.now()); el.setAttribute('data-viewing', 'true'); } 
    else { const start = parseInt(el.getAttribute('data-start')); if (start > 0) { adStats[adId] += (Date.now() - start); el.setAttribute('data-start', '0'); el.setAttribute('data-viewing', 'false'); } }
}

function hLike(btn, e) {
    btn.classList.add('liked');
    const x = e ? e.clientX : window.innerWidth / 2;
    const y = e ? e.clientY : window.innerHeight / 2;
    const heart = document.createElement('div'); heart.className = 'floating-heart'; heart.innerHTML = 'â¤';
    heart.style.left = x + 'px'; heart.style.top = y + 'px';
    document.body.appendChild(heart); setTimeout(() => heart.remove(), 800);
}

function openModal(isFinal) {
    document.querySelectorAll('.video-item[data-viewing="true"]').forEach(el => recordTime(el, false));
    const r = Math.random().toString(36).substring(2, 5).toUpperCase();
    const code = `S-REC-${r}-${Object.keys(adStats).map(k => `${k}:${(adStats[k]/1000).toFixed(1)}s`).join(',')}`;
    document.getElementById('code-display').innerText = code;
    document.getElementById('result-modal').style.display = 'flex';
}

function copyCode() { navigator.clipboard.writeText(document.getElementById('code-display').innerText).then(()=>alert("éªŒè¯ç å·²å¤åˆ¶")); }

// ğŸ”´ ç²¾å‡†æ¢æµ‹è§‚å¯Ÿå™¨ï¼šæå‰ 1200px å¼‚æ­¥å”¤é†’ 4 ä¸ªè§†é¢‘
const obs = new IntersectionObserver(entries => {
    entries.forEach(e => {
        const v = e.target.querySelector('video');
        if (e.isIntersecting) {
            checkAndPrime(v); v.muted = false; v.play().catch(()=>{}); recordTime(e.target, true);
        } else {
            v.pause(); v.muted = true; recordTime(e.target, false);
        }
    });
}, { threshold: 0.65, rootMargin: '1200px 0px' }); 

initData(); renderUI();
document.querySelectorAll('.video-item').forEach(el => obs.observe(el));
</script>
</body>
</html>