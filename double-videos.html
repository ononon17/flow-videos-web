<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>ç¤¾äº¤åª’ä½“å†…å®¹ç ”ç©¶</title>
<style>
/* --- åŸºç¡€æ ·å¼ --- */
*{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent;}
body{background-color:#f6f7f9;color:#333;font-family:-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; overflow: hidden; height: 100vh; width: 100vw;}

/* --- å®éªŒå‡†å¤‡é¡µ --- */
#prep-page { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: #000; color: #fff; z-index: 50000; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; }
#prep-page h1 { font-size: 32px; margin-bottom: 20px; letter-spacing: 2px; }
#prep-page p { font-size: 18px; color: #888; margin-bottom: 60px; }
#start-btn { background-color: #ff2442; color: white; padding: 18px 60px; border-radius: 12px; font-size: 20px; font-weight: bold; border: none; cursor: pointer; }

/* --- é¡µé¢å®¹å™¨ --- */
.page-container { position: absolute; top: 0; left: 0; width: 100%; height: 100%; overflow-y: auto; transition: transform 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94); }
#grid-page-container { z-index: 1; background-color:#f6f7f9; padding: 10px; padding-bottom: 80px; display: none; }
#fullscreen-page-container { z-index: 2; background-color:#000; transform: translateX(100%); scroll-snap-type:y mandatory; overflow-y:scroll;}
#fullscreen-page-container.active { transform: translateX(0); }

/* --- é¦–é¡µç½‘æ ¼ --- */
#grid-feed { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
.grid-item { background: #fff; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 6px rgba(0,0,0,0.05); position: relative; cursor: pointer; }
.grid-video-wrapper { position: relative; width: 100%; padding-bottom: 133%; background: #000; pointer-events: none; }
.grid-video-wrapper video { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; }
.grid-play-icon { position: absolute; top: 10px; right: 10px; color: rgba(255,255,255,0.9); font-size: 16px; }
.card-footer { padding: 10px; }
.video-desc-grid { font-size: 13px; line-height: 1.4; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; font-weight: 500; color: #333; margin-bottom: 8px; min-height: 36px; }

/* --- å…¨å±æ²‰æµ¸é¡µ --- */
.fs-video-item { position:relative;width:100%;height:100%;scroll-snap-align:start;display:flex;justify-content:center;align-items:center;background:#000;overflow:hidden }
.fs-video-item video { width:100%;height:100%;object-fit:cover;display:block }
.overlay { position:absolute;bottom:0;left:0;width:100%;height:100%;pointer-events:none;background:linear-gradient(to top,rgba(0,0,0,0.6),transparent 35%);display:flex;flex-direction:column;justify-content:flex-end;padding:20px 15px; color:#fff; }
.sidebar-fs { position:absolute;right:10px;bottom:100px;display:flex;flex-direction:column;gap:20px;pointer-events:auto;align-items:center;z-index:10; }
.icon-btn-fs { width:40px;height:40px;background:rgba(255,255,255,0.15);border-radius:50%;display:flex;justify-content:center;align-items:center;font-size:22px;backdrop-filter:blur(4px); }

/* --- å…¨å±€æŒ‰é’® --- */
#global-finish-btn { position: fixed; right: 20px; bottom: 30px; z-index: 9999; width: 55px; height: 55px; background: #25D366; color: white; font-size: 13px; font-weight: bold; display: none; flex-direction: column; justify-content: center; align-items: center; border-radius: 50%; cursor: pointer; box-shadow: 0 4px 12px rgba(37, 211, 102, 0.4); }
#global-back-btn { position: fixed; top: 30px; left: 20px; z-index: 9999; width: 36px; height: 36px; background: rgba(0,0,0,0.4); border: 1px solid rgba(255,255,255,0.2); border-radius: 50%; backdrop-filter: blur(4px); display: none; justify-content: center; align-items: center; color: #fff; }

/* --- å¼¹çª— --- */
#result-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 60000; justify-content: center; align-items: center; }
.modal-content { background: #fff; color: #333; padding: 25px; border-radius: 16px; width: 85%; max-width: 320px; text-align: center; position: relative; }
.code-box { background: #f1f3f5; padding: 12px; margin: 15px 0; font-family: monospace; font-size: 11px; line-height:1.4; color: #d32f2f; border: 1px dashed #ccc; border-radius: 8px; word-break: break-all; }
.copy-btn { background: #2196F3; color: white; border: none; padding: 12px 0; border-radius: 8px; font-size: 16px; font-weight: bold; width: 100%; cursor: pointer; margin-bottom: 10px; }
.close-btn { background: #eee; color: #666; border: none; padding: 10px 0; border-radius: 8px; font-size: 14px; width: 100%; cursor: pointer; }
#modal-x-btn { position: absolute; top: 10px; right: 15px; font-size: 24px; color: #bbb; cursor: pointer; }
</style>
</head>
<body>

<div id="prep-page">
    <h1>å®éªŒå‡†å¤‡å°±ç»ª</h1>
    <p>è¯·å¼€å¯æ‰‹æœºéŸ³é‡</p>
    <button id="start-btn" onclick="startBrowsing()">ç‚¹å‡»å¼€å§‹æµè§ˆ</button>
</div>

<div id="grid-page-container" class="page-container">
    <div id="grid-feed"></div>
</div>

<div id="fullscreen-page-container" class="page-container">
    <div id="fullscreen-feed"></div>
</div>

<div id="global-finish-btn" onclick="openModal(true)">âœ”<br>ç»“æŸ</div>
<div id="global-back-btn" onclick="exitFullScreen()">â®</div>

<div id="result-modal">
    <div class="modal-content">
        <div id="modal-x-btn" onclick="closeModal()">Ã—</div>
        <div style="font-weight:bold; font-size:18px;">å®éªŒæé†’</div>
        <p style="font-size:13px; color:#666; margin-top:10px;">è¯·åŠ¡å¿…å¤åˆ¶ä¸‹æ–¹éªŒè¯ç ï¼š<br>(å·²å°è¯•è‡ªåŠ¨å¤åˆ¶)</p>
        <div class="code-box" id="code-display"></div>
        <button class="copy-btn" onclick="copyCode()">æ‰‹åŠ¨å¤åˆ¶éªŒè¯ç </button>
        <button id="modal-return-btn" class="close-btn" onclick="closeModal()">è¿”å›æµè§ˆ</button>
    </div>
</div>

<script>
// --- 1. å¹²å‡€çš„æ•°æ®æº (å»é™¤åç¼€) ---
const adRaw = [
    { id: "Longines", tag: "W1", url: "https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/6f41955d07179e17aa0e3b87394cf88c.MP4", desc: "Longinesæµªç´è¡¨ï¼šä¼˜é›…æ€åº¦ï¼ŒçœŸæˆ‘ä¸ªæ€§ âŒšï¸" },
    { id: "Casio", tag: "W2", url: "https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/1a2ab6a2567fa104084b1f1ef0f366fe.MP4", desc: "CASIOå¡è¥¿æ¬§ï¼šåšéŸ§ä¸æ­¢ï¼Œæ½®æµå…ˆé”‹ğŸ¤˜" },
    { id: "OPPO", tag: "P1", url: "https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/1c119470ab39cf18c4c7da419f8b4276.mov", desc: "OPPO Find Xï¼šç§‘æŠ€ä¹‹å–„ï¼Œä¸€ç¬å€¾å¿ƒ ğŸ“±" },
    { id: "Honor", tag: "P2", url: "https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/d185adecd1feadf6fcb59df491fa1ee6.MP4", desc: "HONORè£è€€ï¼šç¬ƒè¡Œè‡´è¿œï¼Œè£è€€åŒè¡Œ ğŸš€" },
    { id: "Dabao", tag: "S1", url: "https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/8335b86b739187f29afcb3a8ed798b60.mov", desc: "å¤§å®ï¼šå¤©å¤©è§ï¼ŒçœŸæƒ…å®ˆæŠ¤ SODèœœ âœ¨" },
    { id: "Chando", tag: "S2", url: "https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/89a65e149982ff319e90d49de2de4058.MP4", desc: "è‡ªç„¶å ‚ï¼šé›ªåŸŸå†°è‚Œï¼Œä½ æœ¬æ¥å°±å¾ˆç¾ ğŸ”ï¸" }
];

const nativeCats = [
    { type: "food", links: ["https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/9cb3038b5cd9cf8a5e0d3dbd3777079f.MP4","https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/d1ce20c07df8e58e2c0234d038d5ff9c.MP4","https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/6ea9d5dc591d7b94bca7bc52225df31f.MP4","https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/ba5692b9bb0f19ef899c43aaec24b874.MP4","https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/9490d9ae3898c3c6fe64478787e12305.MP4","https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/809f8bca29d20f298627b62e0a66e1a1.MP4","https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/072a130e6fe54342aef13ce8bc81bc84.mov","https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/d274bd241a4ac6177358ec440509b9f9.MP4","https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/10292bbf1c9c525b1a8a5fac54125a48.mov"], titles: ["è°æ‡‚å•Šï¼è¿™ç›˜ç”œç‚¹å¤ªæ²»æ„ˆäº†ğŸœ", "æ•‘å‘½...æ·±å¤œé£Ÿå ‚çš„é­…åŠ›å—ğŸ°", "ç»ç»å­ï¼è¿™ä¸ªæ±‰å ¡çœŸçš„å¤ªç¾å‘³äº†âœ¨", "äº”åˆ†é’Ÿå­¦ä¼šç«è…¿è‚ ç„–é¸¡è›‹ğŸ¤¤", "å®¶äººä»¬ï¼Œæˆ‘çœŸçš„ç¬‘å‘è´¢äº†ğŸ³", "æœ¬åœ°äººç§è—ï¼è¿™æ‰æ˜¯è›‹ç³•å¤©èŠ±æ¿ğŸ•", "å¤åˆ»æˆåŠŸï¼åœ¨å®¶åšå‡ºé¡¶çº§ç«é¸¡é¢", "è¿™è‰²æ³½ï¼çœ‹åˆ°æœ€åæµäº†ä¸€åœ°å£æ°´ğŸ’¦", "ä»Šæ—¥ä»½å¿«ä¹æ˜¯æ‹¿é“ç»™çš„ğŸ¥˜"] },
    { type: "variety", links: ["https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/224d2320db82f468e0f61bac29b0631d.MP4","https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/0e9ce81ab7ae5612973e168ae530e7bd.MP4","https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/c291690cf2ad86c1fb5bd8c6492476c4.MP4","https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/c429a062f64d9b817c0e0332f5dbe3f9.MP4","https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/db3c30002d626d081680a6a99c2cad8e.MP4","https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/c111d107b33699d5d4bf2528eb7c757c.MP4","https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/d7bca7e3fb4c3a984773b2b6f45a7d04.MP4","https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/03b18c6151c04b68ae573894bb2c1370.MP4","https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/fe37a2d2bfe0e2c6e357705a62a5de53.MP4"], titles: ["ç»¼è‰ºååœºé¢ï¼å…¨åœºéƒ½è¢«ç‡ƒåˆ°äº†ğŸ”¥", "è¿™æ®µæˆ‘çœŸçš„ç¬‘åˆ°æ‰“é¸£ï¼Œçœ‹äº†åéğŸ¤£", "ç¥çº§è½¬åœºï¼è¿™ä¹Ÿå¤ªä¸æ»‘äº†ğŸ¬", "çœŸæƒ…æµéœ²ï¼šå…¨åœºå˜‰å®¾éƒ½çœ‹å“­äº†ğŸ˜­", "çˆ†ç¬‘é¢„è­¦ï¼è¿™ä¸ªæ¢—æˆ‘èƒ½ç©ä¸€å¹´ğŸ¤¡", "åä¾¦æ¢æ—¶åˆ»ï¼è¿™æ³¢åˆ†ææˆ‘å†…è¡ŒğŸ•µï¸", "è¿™å°±æ˜¯ä¸“ä¸šé€‰æ‰‹çš„å®åŠ›å—ï¼Ÿè·ªäº†ğŸ™", "ç¤¾æ­»ç°åœºï¼šæˆ‘æ›¿äººå°´å°¬çš„æ¯›ç—…çŠ¯äº†ğŸ™ˆ", "ä¸åˆ°æœ€åä¸€ç§’ç»å¯¹çŒœä¸åˆ°å‰§æƒ…ğŸŒ€"] },
    { type: "comedy", links: ["https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/d92e7a8c43b8f52618e52b227cb49d4a.MP4","https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/3b03c532c9ab2488380b510b20795dce.MP4","https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/899d1c39ab8c6355619af4d1b63b57f4.MP4","https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/ad54701eecc91d9d63655b90bd6a9a28.MP4","https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/a725c0c79871ef092a27ca786b199813.MP4","https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/1b7d44ae2f3bf47cea1a0521feffc97c.MP4","https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/54ac52d07178f6e577b88f5a691cdae6.MP4","https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/18b6f4865bade59168068d120b9fa70b.MP4","https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/9697e3b13e163eb2ac045428d1bd5fa7.MP4"], titles: ["å¤§å­¦ç”Ÿçš„ç²¾ç¥çŠ¶æ€ï¼ŒçœŸå®åˆ°æƒ³å“­ğŸ˜‚", "ç¬‘å‘è´¢äº†ï¼Œè¿™æ“ä½œæˆ‘æ˜¯æ²¡æƒ³åˆ°çš„ğŸ’°", "å…³äºæˆ‘å¦‚ä½•åœ¨ä¸€åˆ†é’Ÿå†…è®©å…¨åœºæ²‰é»˜ğŸ¤¡", "ä»Šæ—¥ä»½å¹½é»˜å·²é€è¾¾ï¼Œè¯·ç­¾æ”¶ğŸ“®", "æˆ‘å’Œæˆ‘çš„å¤§å†¤ç§æœ‹å‹çš„æ—¥å¸¸ğŸ‘­", "æœ¬æ¥æŒºä¼¤æ„Ÿï¼Œçœ‹åˆ°æœ€åç¬‘å–·äº†ğŸ’¥", "è¿™å±Šç½‘å‹å¤ªæœ‰æ‰äº†ï¼Œè¯„è®ºåŒºæ›´ç²¾å½©ğŸ’¬", "å·æ‹è¢«äººå‘ç°ï¼Œå°´å°¬ç—…çŠ¯äº†ğŸ‘»", "è°è®¾è®¡çš„è¿™ä¸ªå‰§æƒ…ï¼Ÿç«™å‡ºæ¥ğŸ‘Š"] },
    { type: "travel", links: ["https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/2c13f0ec2632db517d5121ede6b64993.mov","https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/222ddf22f8ecdd36fdd6b338a36d97f5.MP4","https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/4cc6bbd6c027d96cef6ca79c7dab2b9d.mov","https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/ca7fa1fb72c5847d8766ce10f3372788.MP4","https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/c70155ef59964ab38f15589833a670ba.MP4","https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/014ff2312c0eeaa4c7f801e3544d4302.mov","https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/50ea2aad16b82e75f3310ce019c4e358.MP4","https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/c12c417443e17e37f597e63c16e0ae80.MP4"], titles: ["äº‘å—æ—…æ¸¸çš„æ­£ç¡®é¡ºåºğŸ“¸", "äº‘å—å¤§ç†çš„æ—¥è½å€¼å¾—å¥”èµ´åƒé‡ŒğŸŒŠ", "ç´¯äº†å°±å»äº‘å—å‘å‘å‘†å§â˜ï¸", "å¤§ç†ï¼Œè¿ç©ºæ°”éƒ½æ˜¯è‡ªç”±çš„ğŸƒ", "äº‘å—æ´±æµ·ï¼šæ­¤ç”Ÿå¿…å»çš„åœ°æ–¹ğŸ“", "å¤§ç†æ´±æµ·ï¼Œå‘å¾€çš„ç”Ÿæ´»ğŸï¸", "äº‘å—æ—…æ¸¸é¿å‘æŒ‡å—ï¼Œå»ºè®®æ”¶è—ğŸ“‘", "äº‘å—å¤§ç†ï¼ŒçœŸçš„æœ‰åœ¨å¤©å ‚çš„é”™è§‰ğŸŒ´"] }
];

// --- 2. é€»è¾‘å¼•æ“ ---
let adStats = { "Longines": 0, "Casio": 0, "OPPO": 0, "Honor": 0, "Dabao": 0, "Chando": 0 };
let currentAdEnterTime = 0, currentAdProduct = null, isViewingAd = false, forceEnd = false, playlist = [];

function shuffle(a) { for (let i = a.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [a[i], a[j]] = [a[j], a[i]]; } return a; }

function init() {
    let allN = [];
    nativeCats.forEach(c => c.links.forEach((l, i) => {
        // ç”Ÿæˆæ™®é€šè§†é¢‘ç‚¹èµï¼š1.1w - 9.9w
        const likes = (Math.random() * 8.8 + 1.1).toFixed(1) + "w";
        allN.push({ url: l, desc: c.titles[i], type: "content", likes: likes });
    }));
    shuffle(allN);
    let sAds = shuffle([...adRaw]).map(ad => {
        // ç”Ÿæˆå¹¿å‘Šè§†é¢‘ç‚¹èµï¼š1w - 3w
        const likes = (Math.random() * 2 + 1).toFixed(1) + "w";
        return { ...ad, likes: likes, type: "ad" };
    });
    
    let nIdx = 0, aIdx = 0;
    for (let i = 1; i <= 41; i++) {
        if ([6, 12, 18, 24, 30, 36].includes(i)) playlist.push(sAds[aIdx++]);
        else playlist.push(allN[nIdx++]);
    }
}

function startBrowsing() {
    document.getElementById('prep-page').style.display = 'none';
    document.getElementById('grid-page-container').style.display = 'block';
    setTimeout(() => openModal(false), 120000); // 2åˆ†é’Ÿè‡ªåŠ¨å¼¹çª—
}

function render() {
    const g = document.getElementById('grid-feed'), f = document.getElementById('fullscreen-feed');
    playlist.forEach((item, i) => {
        const gd = document.createElement('div'); gd.className = 'grid-item';
        gd.innerHTML = `<div class="grid-video-wrapper"><video src="${item.url}#t=0.1" preload="metadata" muted></video><div class="grid-play-icon">â–¶</div></div><div class="card-footer"><div class="video-desc-grid">${item.desc}</div><div style="font-size:11px;color:#999">ç”¨æˆ·_${1000+i} Â· â¤ ${item.likes}</div></div>`;
        gd.onclick = () => enterFS(i); g.appendChild(gd);

        const fd = document.createElement('div'); fd.className = 'fs-video-item';
        if(item.type==='ad') fd.setAttribute('data-ad', item.id);
        fd.innerHTML = `<video src="${item.url}" loop playsinline></video><div class="overlay"><b>@ç”¨æˆ·_${1000+i}</b><p>${item.desc}</p></div><div class="sidebar-fs"><div class="icon-btn-fs">â¤</div><div class="icon-btn-fs">ğŸ’¬</div></div>`;
        const v = fd.querySelector('video'); fd.onclick = (e) => { if(!e.target.closest('.sidebar-fs')) v.paused ? v.play() : v.pause(); };
        f.appendChild(fd);
    });
}

function enterFS(i) {
    document.getElementById('fullscreen-page-container').classList.add('active');
    const items = document.querySelectorAll('.fs-video-item');
    items[i].scrollIntoView(); items[i].querySelector('video').play();
    document.getElementById('global-back-btn').style.display = 'flex';
}

function exitFullScreen() {
    document.getElementById('fullscreen-page-container').classList.remove('active');
    document.querySelectorAll('.fs-video-item video').forEach(v => v.pause());
    document.getElementById('global-back-btn').style.display = 'none';
}

function openModal(isFinal) {
    if (isViewingAd && currentAdProduct) adStats[currentAdProduct] += (Date.now() - currentAdEnterTime);
    const r = Math.random().toString(36).substring(2, 5).toUpperCase();
    const map = { "Longines":"W1", "Casio":"W2", "OPPO":"P1", "Honor":"P2", "Dabao":"S1", "Chando":"S2" };
    const code = `${r}-${Object.keys(adStats).map(k => `${map[k]}:${(adStats[k]/1000).toFixed(1)}s`).join(',')}`;
    document.getElementById('code-display').innerText = code;
    navigator.clipboard.writeText(code).catch(()=>{});

    if(isFinal) {
        forceEnd = true;
        document.getElementById('modal-x-btn').style.display = 'none';
        document.getElementById('modal-return-btn').style.display = 'none';
        document.getElementById('global-finish-btn').style.display = 'none';
    }
    document.getElementById('result-modal').style.display = 'flex';
    exitFullScreen();
}

function closeModal() {
    if (forceEnd) return;
    document.getElementById('result-modal').style.display = 'none';
    document.getElementById('global-finish-btn').style.display = 'flex';
}

function copyCode() {
    const txt = document.getElementById('code-display').innerText;
    navigator.clipboard.writeText(txt).then(() => alert("éªŒè¯ç å·²å­˜å…¥å‰ªåˆ‡æ¿ï¼"));
}

const observer = new IntersectionObserver(entries => {
    if (!document.getElementById('fullscreen-page-container').classList.contains('active')) return;
    entries.forEach(e => {
        const v = e.target.querySelector('video'), prod = e.target.getAttribute('data-ad');
        if (e.isIntersecting) {
            v.play(); if (prod) { currentAdEnterTime = Date.now(); currentAdProduct = prod; isViewingAd = true; }
        } else {
            v.pause(); if (prod && isViewingAd && currentAdProduct === prod) { adStats[prod] += (Date.now() - currentAdEnterTime); isViewingAd = false; }
        }
    });
}, { threshold: 0.6, root: document.getElementById('fullscreen-page-container') });

init(); render();
document.querySelectorAll('.fs-video-item').forEach(el => observer.observe(el));
</script>
</body>
</html>